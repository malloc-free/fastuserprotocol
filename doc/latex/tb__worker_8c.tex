\hypertarget{tb__worker_8c}{\section{src/tb\-\_\-worker.c File Reference}
\label{tb__worker_8c}\index{src/tb\-\_\-worker.\-c@{src/tb\-\_\-worker.\-c}}
}
{\ttfamily \#include \char`\"{}tb\-\_\-worker.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tb\-\_\-session.\-h\char`\"{}}\\*
{\ttfamily \#include $<$gdsl/gdsl\-\_\-queue.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$assert.\-h$>$}\\*
{\ttfamily \#include $<$pthread.\-h$>$}\\*
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$sys/socket.\-h$>$}\\*
Include dependency graph for tb\-\_\-worker.\-c\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{tb__worker_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{tb__worker_8c_af9d62097df66ab4d05386c49b45a74e8}{do\-\_\-work} (void $\ast$param)
\begin{DoxyCompactList}\small\item\em Start work. \end{DoxyCompactList}\item 
\hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t} $\ast$ \hyperlink{tb__worker_8c_a10a515d12c8fb7885a5cd5d1a67141fc}{create\-\_\-worker} ()
\begin{DoxyCompactList}\small\item\em Create a new worker, allocating memory as required. \end{DoxyCompactList}\item 
void \hyperlink{tb__worker_8c_aa7815ec198375441b2d6dad28f0c6fce}{destroy\-\_\-worker} (\hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t} $\ast$w)
\begin{DoxyCompactList}\small\item\em Destroy the given worker, freeing memory. \end{DoxyCompactList}\item 
void \hyperlink{tb__worker_8c_aa5ef220c5813db06b41fccbf885a5727}{add\-\_\-work} (\hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t} $\ast$worker, \hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$data)
\begin{DoxyCompactList}\small\item\em Add work to a worker. \end{DoxyCompactList}\item 
\hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$ \hyperlink{tb__worker_8c_aceb05b8d10c44e2979cc78b5bde1b369}{get\-\_\-work} (\hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t} $\ast$worker)
\begin{DoxyCompactList}\small\item\em Get work for this worker. \end{DoxyCompactList}\item 
long int \hyperlink{tb__worker_8c_a8746fc48b8ce47ad0bdc8b521f7708d0}{compare\-\_\-workers} (gdsl\-\_\-element\-\_\-t E, void $\ast$value)
\begin{DoxyCompactList}\small\item\em Compare two workers, required by gdsl\-\_\-heap. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{tb__worker_8c_aa5ef220c5813db06b41fccbf885a5727}{\index{tb\-\_\-worker.\-c@{tb\-\_\-worker.\-c}!add\-\_\-work@{add\-\_\-work}}
\index{add\-\_\-work@{add\-\_\-work}!tb_worker.c@{tb\-\_\-worker.\-c}}
\subsubsection[{add\-\_\-work}]{\setlength{\rightskip}{0pt plus 5cm}void add\-\_\-work (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-worker\-\_\-t} $\ast$}]{worker, }
\item[{{\bf tb\-\_\-session\-\_\-t} $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{tb__worker_8c_aa5ef220c5813db06b41fccbf885a5727}


Add work to a worker. 

Add work to the given worker. Is thread-\/safe, so it will block if another thread is adding work to the queue. The work is added to the work queue in the given worker.

\begin{DoxyPrecond}{Precondition}
worker must be of struct type \hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t}. 

data must be of type \hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t}.  parameters can be N\-U\-L\-L. 
\end{DoxyPrecond}

\begin{DoxyParams}{Parameters}
{\em worker} & The worker to add work to. \\
\hline
{\em data} & The work to be added. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 72 of file tb\-\_\-worker.\-c.

\hypertarget{tb__worker_8c_a8746fc48b8ce47ad0bdc8b521f7708d0}{\index{tb\-\_\-worker.\-c@{tb\-\_\-worker.\-c}!compare\-\_\-workers@{compare\-\_\-workers}}
\index{compare\-\_\-workers@{compare\-\_\-workers}!tb_worker.c@{tb\-\_\-worker.\-c}}
\subsubsection[{compare\-\_\-workers}]{\setlength{\rightskip}{0pt plus 5cm}long int compare\-\_\-workers (
\begin{DoxyParamCaption}
\item[{gdsl\-\_\-element\-\_\-t}]{E, }
\item[{void $\ast$}]{value}
\end{DoxyParamCaption}
)}}\label{tb__worker_8c_a8746fc48b8ce47ad0bdc8b521f7708d0}


Compare two workers, required by gdsl\-\_\-heap. 

gdsl\-\_\-heap\-\_\-t is a max heap, so workers with a lesser number of tasks will return $>$ 0, same number of tasks = 0, and greater number of tasks $<$ 0.

\begin{DoxyPrecond}{Precondition}
E and value must be both of struct type worker. 

E and value cannot be N\-U\-L\-L. 
\end{DoxyPrecond}

\begin{DoxyParams}{Parameters}
{\em E} & The element to compare. \\
\hline
{\em value} & The element to compare against. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/1, 0 and 1 if E is greater, equal, or less than. 
\end{DoxyReturn}


Definition at line 109 of file tb\-\_\-worker.\-c.

\hypertarget{tb__worker_8c_a10a515d12c8fb7885a5cd5d1a67141fc}{\index{tb\-\_\-worker.\-c@{tb\-\_\-worker.\-c}!create\-\_\-worker@{create\-\_\-worker}}
\index{create\-\_\-worker@{create\-\_\-worker}!tb_worker.c@{tb\-\_\-worker.\-c}}
\subsubsection[{create\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-worker\-\_\-t}$\ast$ create\-\_\-worker (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{tb__worker_8c_a10a515d12c8fb7885a5cd5d1a67141fc}


Create a new worker, allocating memory as required. 

\begin{DoxyNote}{Note}
Each worker gets a new, unique id that is generated at the time of creation 
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
worker$\ast$ Pointer to new \hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t}. 
\end{DoxyReturn}


Definition at line 44 of file tb\-\_\-worker.\-c.

\hypertarget{tb__worker_8c_aa7815ec198375441b2d6dad28f0c6fce}{\index{tb\-\_\-worker.\-c@{tb\-\_\-worker.\-c}!destroy\-\_\-worker@{destroy\-\_\-worker}}
\index{destroy\-\_\-worker@{destroy\-\_\-worker}!tb_worker.c@{tb\-\_\-worker.\-c}}
\subsubsection[{destroy\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}void destroy\-\_\-worker (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-worker\-\_\-t} $\ast$}]{w}
\end{DoxyParamCaption}
)}}\label{tb__worker_8c_aa7815ec198375441b2d6dad28f0c6fce}


Destroy the given worker, freeing memory. 

\begin{DoxyNote}{Note}

\end{DoxyNote}
\begin{DoxyPrecond}{Precondition}
w must be of struct type worker. 
\end{DoxyPrecond}

\begin{DoxyParams}{Parameters}
{\em w} & The worker to destroy \\
\hline
\end{DoxyParams}


Definition at line 61 of file tb\-\_\-worker.\-c.

\hypertarget{tb__worker_8c_af9d62097df66ab4d05386c49b45a74e8}{\index{tb\-\_\-worker.\-c@{tb\-\_\-worker.\-c}!do\-\_\-work@{do\-\_\-work}}
\index{do\-\_\-work@{do\-\_\-work}!tb_worker.c@{tb\-\_\-worker.\-c}}
\subsubsection[{do\-\_\-work}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ do\-\_\-work (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{worker}
\end{DoxyParamCaption}
)}}\label{tb__worker_8c_af9d62097df66ab4d05386c49b45a74e8}


Start work. 

This is the function that is passed to pthread\-\_\-create. The worker struct is passed in by pthread\-\_\-create as per the api

\begin{DoxySeeAlso}{See Also}
pthread.\-h 

pthread\-\_\-create 
\end{DoxySeeAlso}
\begin{DoxyPrecond}{Precondition}
param Must be of struct type worker, cannot be N\-U\-L\-L. 
\end{DoxyPrecond}

\begin{DoxyParams}{Parameters}
{\em worker} & The worker to do the specified work. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 25 of file tb\-\_\-worker.\-c.

\hypertarget{tb__worker_8c_aceb05b8d10c44e2979cc78b5bde1b369}{\index{tb\-\_\-worker.\-c@{tb\-\_\-worker.\-c}!get\-\_\-work@{get\-\_\-work}}
\index{get\-\_\-work@{get\-\_\-work}!tb_worker.c@{tb\-\_\-worker.\-c}}
\subsubsection[{get\-\_\-work}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-session\-\_\-t}$\ast$ get\-\_\-work (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-worker\-\_\-t} $\ast$}]{worker}
\end{DoxyParamCaption}
)}}\label{tb__worker_8c_aceb05b8d10c44e2979cc78b5bde1b369}


Get work for this worker. 

Gets a unit of work for this worker. Blocks if the queue is empty.

\begin{DoxyPrecond}{Precondition}
worker must be of struct type worker. 

worker cannot be N\-U\-L\-L 
\end{DoxyPrecond}

\begin{DoxyParams}{Parameters}
{\em worker} & The worker to fetch the work for. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Work to be done by this \hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t}. 
\end{DoxyReturn}


Definition at line 86 of file tb\-\_\-worker.\-c.


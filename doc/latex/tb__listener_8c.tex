\hypertarget{tb__listener_8c}{\section{src/tb\-\_\-listener.c File Reference}
\label{tb__listener_8c}\index{src/tb\-\_\-listener.\-c@{src/tb\-\_\-listener.\-c}}
}
{\ttfamily \#include \char`\"{}tb\-\_\-listener.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tb\-\_\-worker\-\_\-pair.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tb\-\_\-protocol.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tb\-\_\-common.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tb\-\_\-worker.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tb\-\_\-logging.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tb\-\_\-sock\-\_\-opt.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tb\-\_\-session.\-h\char`\"{}}\\*
{\ttfamily \#include $<$gdsl/gdsl\-\_\-heap.\-h$>$}\\*
{\ttfamily \#include $<$gdsl/gdsl\-\_\-hash.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$pthread.\-h$>$}\\*
{\ttfamily \#include $<$sys/socket.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$netdb.\-h$>$}\\*
{\ttfamily \#include $<$errno.\-h$>$}\\*
{\ttfamily \#include $<$fcntl.\-h$>$}\\*
{\ttfamily \#include $<$sys/epoll.\-h$>$}\\*
{\ttfamily \#include $<$udt.\-h$>$}\\*
{\ttfamily \#include $<$assert.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$sys/syscall.\-h$>$}\\*
{\ttfamily \#include $<$sys/sysinfo.\-h$>$}\\*
{\ttfamily \#include $<$glib-\/2.\-0/glib.\-h$>$}\\*
Include dependency graph for tb\-\_\-listener.\-c\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{tb__listener_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$ \hyperlink{tb__listener_8c_a5ec3b6c120621050965582e51e4d0d5a}{tb\-\_\-create\-\_\-listener} (\hyperlink{tb__listener_8h_ae37f3ebcf0081b2dd11adf41f1f867d6}{E\-N\-D\-P\-O\-I\-N\-T\-\_\-\-T\-Y\-P\-E} type, char $\ast$addr, char $\ast$port, \hyperlink{tb__protocol_8h_a7a5bff1040fc154c510874327d44cc1a}{P\-R\-O\-T\-O\-C\-O\-L} protocol, int bufsize)
\begin{DoxyCompactList}\small\item\em Create a listener with the supplied parameters. \end{DoxyCompactList}\item 
\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$ \hyperlink{tb__listener_8c_a042a2b565ccc70e1506562ad43c83bfb}{tb\-\_\-create\-\_\-endpoint} (\hyperlink{structtb__test__params__t}{tb\-\_\-test\-\_\-params\-\_\-t} $\ast$params)
\begin{DoxyCompactList}\small\item\em Create a listener using a \hyperlink{structtb__test__params__t}{tb\-\_\-test\-\_\-params\-\_\-t} struct. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_a104d49d9fbeed470cf0a9de8706c0af8}{tb\-\_\-setup\-\_\-workers} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, int num\-\_\-threads)
\item 
\hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t} $\ast$ \hyperlink{tb__listener_8c_aadc6c1af686cf9fc7bbd8874eca3be42}{tb\-\_\-get\-\_\-worker} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, \hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$session)
\begin{DoxyCompactList}\small\item\em Get a worker for the supplied session. \end{DoxyCompactList}\item 
\hyperlink{structtb__worker__t}{tb\-\_\-worker\-\_\-t} $\ast$ \hyperlink{tb__listener_8c_a215355da81075fa189618103a0bfb916}{tb\-\_\-get\-\_\-session} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, \hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$session)
\item 
void \hyperlink{tb__listener_8c_aa1646d6df4318c903d2653a6032a0a40}{tb\-\_\-get\-\_\-cpu\-\_\-info} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\item 
void \hyperlink{tb__listener_8c_a370d0eb443de6db87ab002ea2e5cc468}{tb\-\_\-destroy\-\_\-listener} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Destroy a listener. \end{DoxyCompactList}\item 
void \hyperlink{tb__listener_8c_af552255cac39c1b712a1c213070c04e0}{tb\-\_\-print\-\_\-listener} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Print a listener. \end{DoxyCompactList}\item 
\hyperlink{structtb__prot__stats__t}{tb\-\_\-prot\-\_\-stats\-\_\-t} $\ast$ \hyperlink{tb__listener_8c_a6e5c88a915882ea9d39fd41ee4742ffc}{tb\-\_\-ex\-\_\-get\-\_\-stats} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em A thread safe way to get access to stats. \end{DoxyCompactList}\item 
void \hyperlink{tb__listener_8c_ae063a1fdce497a4e08aea504a6ab927b}{tb\-\_\-set\-\_\-l\-\_\-stats} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Gets the stats for the listener. \end{DoxyCompactList}\item 
void \hyperlink{tb__listener_8c_a144e59e2470a90fc2b6e1f840da77ae8}{tb\-\_\-set\-\_\-m\-\_\-stats} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Gets the stats for the listener. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_a05130f296853ae0e2d00aee025f6773a}{tb\-\_\-listen} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Bind and listen. \end{DoxyCompactList}\item 
\hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$ \hyperlink{tb__listener_8c_a8a79bda6c64046a1b527e045c9487ac8}{tb\-\_\-accept} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Accept an incoming connection. \end{DoxyCompactList}\item 
\hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$ \hyperlink{tb__listener_8c_adeff1eb694f2649f6e9452ebbab990c4}{tb\-\_\-epoll\-\_\-accept} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\item 
int \hyperlink{tb__listener_8c_aedd19f27c5b2e1d8717024afed30ec51}{tb\-\_\-resolve\-\_\-address} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Resolve the address for the given listener. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_a453c35ddb0c42f1ecd1b963e7945860f}{tb\-\_\-create\-\_\-socket} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Create a socket. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_afd4a201df5fe1e9b2e8a694ac270255a}{tb\-\_\-connect} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Attempt to connect. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_a26cdc218a6e64bb4afeb7751752a806a}{tb\-\_\-bind} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Bind the listener to its address. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_a259b174a6102fa292d1fd63125cb3035}{tb\-\_\-send\-\_\-data} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, char $\ast$buff, int size)
\begin{DoxyCompactList}\small\item\em Send data. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_a2456170f46148e20d6e87110db95c89c}{tb\-\_\-recv\-\_\-data} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, \hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$session)
\begin{DoxyCompactList}\small\item\em Receive data. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_ab66b3e6da7a5d6df6e36eaefda0a8463}{tb\-\_\-send\-\_\-to} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, \hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$session)
\item 
int \hyperlink{tb__listener_8c_aeeb4e0453d1d48ce53d354b836fa0706}{tb\-\_\-recv\-\_\-from} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, \hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} $\ast$session)
\begin{DoxyCompactList}\small\item\em recv from -\/ used by U\-D\-P. \end{DoxyCompactList}\item 
int \hyperlink{tb__listener_8c_a51ee3fc570bf367b96f646a4d15f313d}{tb\-\_\-set\-\_\-epoll} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener)
\begin{DoxyCompactList}\small\item\em Set epoll for this listener. \end{DoxyCompactList}\item 
void \hyperlink{tb__listener_8c_aca070e070aa077fd83fda3d2f448bfca}{tb\-\_\-error} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, const char $\ast$info, int err\-\_\-no)
\begin{DoxyCompactList}\small\item\em Format an error to the log file. \end{DoxyCompactList}\item 
void \hyperlink{tb__listener_8c_a1a5b9849075e44703d7815be5934af11}{tb\-\_\-address} (\hyperlink{structtb__listener__t}{tb\-\_\-listener\-\_\-t} $\ast$listener, const char $\ast$info, struct sockaddr\-\_\-storage $\ast$store)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{tb__listener_8c_a8a79bda6c64046a1b527e045c9487ac8}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-accept@{tb\-\_\-accept}}
\index{tb\-\_\-accept@{tb\-\_\-accept}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-accept}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-session\-\_\-t}$\ast$ tb\-\_\-accept (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_a8a79bda6c64046a1b527e045c9487ac8}


Accept an incoming connection. 

Accepts incoming connections. This operation blocks, as we are using blocking I/\-O currently


\begin{DoxyParams}{Parameters}
{\em listener} & The listener to accept the connection on. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\hyperlink{structtb__session__t}{tb\-\_\-session\-\_\-t} A newly created session. 
\end{DoxyReturn}


Definition at line 466 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a1a5b9849075e44703d7815be5934af11}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-address@{tb\-\_\-address}}
\index{tb\-\_\-address@{tb\-\_\-address}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-address}]{\setlength{\rightskip}{0pt plus 5cm}void tb\-\_\-address (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{const char $\ast$}]{info, }
\item[{struct sockaddr\-\_\-storage $\ast$}]{store}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_a1a5b9849075e44703d7815be5934af11}


Definition at line 692 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a26cdc218a6e64bb4afeb7751752a806a}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-bind@{tb\-\_\-bind}}
\index{tb\-\_\-bind@{tb\-\_\-bind}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-bind}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-bind (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_a26cdc218a6e64bb4afeb7751752a806a}


Bind the listener to its address. 

Binds the listener to the address specified by address.


\begin{DoxyParams}{Parameters}
{\em listener} & The listener to bind. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, -\/1 on failure. 
\end{DoxyReturn}


Definition at line 564 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_afd4a201df5fe1e9b2e8a694ac270255a}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-connect@{tb\-\_\-connect}}
\index{tb\-\_\-connect@{tb\-\_\-connect}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-connect}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-connect (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_afd4a201df5fe1e9b2e8a694ac270255a}


Attempt to connect. 

Attempts to connect to the specified address and port. 

Definition at line 545 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a042a2b565ccc70e1506562ad43c83bfb}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-create\-\_\-endpoint@{tb\-\_\-create\-\_\-endpoint}}
\index{tb\-\_\-create\-\_\-endpoint@{tb\-\_\-create\-\_\-endpoint}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-create\-\_\-endpoint}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-listener\-\_\-t}$\ast$ tb\-\_\-create\-\_\-endpoint (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-test\-\_\-params\-\_\-t} $\ast$}]{params}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_a042a2b565ccc70e1506562ad43c83bfb}


Create a listener using a \hyperlink{structtb__test__params__t}{tb\-\_\-test\-\_\-params\-\_\-t} struct. 

The details in the struct are used to create an endpoint for use in testing.


\begin{DoxyParams}{Parameters}
{\em params} & A struct with all of the required details for a test. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the endpoint to test with. 
\end{DoxyReturn}


Definition at line 158 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a5ec3b6c120621050965582e51e4d0d5a}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-create\-\_\-listener@{tb\-\_\-create\-\_\-listener}}
\index{tb\-\_\-create\-\_\-listener@{tb\-\_\-create\-\_\-listener}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-create\-\_\-listener}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-listener\-\_\-t}$\ast$ tb\-\_\-create\-\_\-listener (
\begin{DoxyParamCaption}
\item[{{\bf E\-N\-D\-P\-O\-I\-N\-T\-\_\-\-T\-Y\-P\-E}}]{type, }
\item[{char $\ast$}]{addr, }
\item[{char $\ast$}]{port, }
\item[{{\bf P\-R\-O\-T\-O\-C\-O\-L}}]{protocol, }
\item[{int}]{bufsize}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_a5ec3b6c120621050965582e51e4d0d5a}


Create a listener with the supplied parameters. 

Creates a listener and the accociated data structures.


\begin{DoxyParams}{Parameters}
{\em type} & The type of endpoint to create. \\
\hline
{\em addr} & The address to bind to. \\
\hline
{\em port} & The port to bind to. \\
\hline
{\em num\-\_\-threads} & The number of worker threads to use.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The newly created listener. 
\end{DoxyReturn}


Definition at line 38 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a453c35ddb0c42f1ecd1b963e7945860f}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-create\-\_\-socket@{tb\-\_\-create\-\_\-socket}}
\index{tb\-\_\-create\-\_\-socket@{tb\-\_\-create\-\_\-socket}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-create\-\_\-socket}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-create\-\_\-socket (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_a453c35ddb0c42f1ecd1b963e7945860f}


Create a socket. 

Creates a new socket for the specified listener.


\begin{DoxyParams}{Parameters}
{\em The} & listener to create the socket for. \\
\hline
\end{DoxyParams}


Definition at line 527 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a370d0eb443de6db87ab002ea2e5cc468}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-destroy\-\_\-listener@{tb\-\_\-destroy\-\_\-listener}}
\index{tb\-\_\-destroy\-\_\-listener@{tb\-\_\-destroy\-\_\-listener}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-destroy\-\_\-listener}]{\setlength{\rightskip}{0pt plus 5cm}void tb\-\_\-destroy\-\_\-listener (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_a370d0eb443de6db87ab002ea2e5cc468}


Destroy a listener. 

Destroys the listener, and its associated data structures.


\begin{DoxyParams}{Parameters}
{\em listener} & The listener to destroy. \\
\hline
\end{DoxyParams}


Definition at line 282 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_adeff1eb694f2649f6e9452ebbab990c4}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-epoll\-\_\-accept@{tb\-\_\-epoll\-\_\-accept}}
\index{tb\-\_\-epoll\-\_\-accept@{tb\-\_\-epoll\-\_\-accept}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-epoll\-\_\-accept}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-session\-\_\-t}$\ast$ tb\-\_\-epoll\-\_\-accept (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_adeff1eb694f2649f6e9452ebbab990c4}


Definition at line 487 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_aca070e070aa077fd83fda3d2f448bfca}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-error@{tb\-\_\-error}}
\index{tb\-\_\-error@{tb\-\_\-error}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-error}]{\setlength{\rightskip}{0pt plus 5cm}void tb\-\_\-error (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{const char $\ast$}]{info, }
\item[{int}]{err\-\_\-no}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_aca070e070aa077fd83fda3d2f448bfca}


Format an error to the log file. 



Definition at line 676 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a6e5c88a915882ea9d39fd41ee4742ffc}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-ex\-\_\-get\-\_\-stats@{tb\-\_\-ex\-\_\-get\-\_\-stats}}
\index{tb\-\_\-ex\-\_\-get\-\_\-stats@{tb\-\_\-ex\-\_\-get\-\_\-stats}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-ex\-\_\-get\-\_\-stats}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-prot\-\_\-stats\-\_\-t}$\ast$ tb\-\_\-ex\-\_\-get\-\_\-stats (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_a6e5c88a915882ea9d39fd41ee4742ffc}


A thread safe way to get access to stats. 

This method controls access to the stats generated by testbed. These stats are updated every second, and can be read once. If the data that can be obtained by this function has already been read, it blocks until new data has arrived.


\begin{DoxyParams}{Parameters}
{\em listener} & The listener for which to get the stats from. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\hyperlink{structtb__prot__stats__t}{tb\-\_\-prot\-\_\-stats\-\_\-t} with the stats inserted. 
\end{DoxyReturn}


Definition at line 362 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_aa1646d6df4318c903d2653a6032a0a40}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-get\-\_\-cpu\-\_\-info@{tb\-\_\-get\-\_\-cpu\-\_\-info}}
\index{tb\-\_\-get\-\_\-cpu\-\_\-info@{tb\-\_\-get\-\_\-cpu\-\_\-info}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-get\-\_\-cpu\-\_\-info}]{\setlength{\rightskip}{0pt plus 5cm}void tb\-\_\-get\-\_\-cpu\-\_\-info (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_aa1646d6df4318c903d2653a6032a0a40}
Gets the tid from syscall and pthread\-\_\-self, sets them in the listener. 

Definition at line 276 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a215355da81075fa189618103a0bfb916}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-get\-\_\-session@{tb\-\_\-get\-\_\-session}}
\index{tb\-\_\-get\-\_\-session@{tb\-\_\-get\-\_\-session}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-get\-\_\-session}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-worker\-\_\-t}$\ast$ tb\-\_\-get\-\_\-session (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{{\bf tb\-\_\-session\-\_\-t} $\ast$}]{session}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_a215355da81075fa189618103a0bfb916}


Definition at line 270 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_aadc6c1af686cf9fc7bbd8874eca3be42}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-get\-\_\-worker@{tb\-\_\-get\-\_\-worker}}
\index{tb\-\_\-get\-\_\-worker@{tb\-\_\-get\-\_\-worker}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-get\-\_\-worker}]{\setlength{\rightskip}{0pt plus 5cm}{\bf tb\-\_\-worker\-\_\-t}$\ast$ tb\-\_\-get\-\_\-worker (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{{\bf tb\-\_\-session\-\_\-t} $\ast$}]{session}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_aadc6c1af686cf9fc7bbd8874eca3be42}


Get a worker for the supplied session. 



Definition at line 244 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a05130f296853ae0e2d00aee025f6773a}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-listen@{tb\-\_\-listen}}
\index{tb\-\_\-listen@{tb\-\_\-listen}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-listen}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-listen (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_a05130f296853ae0e2d00aee025f6773a}


Bind and listen. 

Binds the listener to the specified port and ip address, and then begins listening.


\begin{DoxyParams}{Parameters}
{\em listener} & The listener to listen. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 
\end{DoxyReturn}


Definition at line 448 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_af552255cac39c1b712a1c213070c04e0}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-print\-\_\-listener@{tb\-\_\-print\-\_\-listener}}
\index{tb\-\_\-print\-\_\-listener@{tb\-\_\-print\-\_\-listener}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-print\-\_\-listener}]{\setlength{\rightskip}{0pt plus 5cm}void tb\-\_\-print\-\_\-listener (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_af552255cac39c1b712a1c213070c04e0}


Print a listener. 

Prints the given listener.


\begin{DoxyParams}{Parameters}
{\em listener} & The listener to print the values for. \\
\hline
\end{DoxyParams}


Definition at line 338 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a2456170f46148e20d6e87110db95c89c}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-recv\-\_\-data@{tb\-\_\-recv\-\_\-data}}
\index{tb\-\_\-recv\-\_\-data@{tb\-\_\-recv\-\_\-data}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-recv\-\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-recv\-\_\-data (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{{\bf tb\-\_\-session\-\_\-t} $\ast$}]{session}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_a2456170f46148e20d6e87110db95c89c}


Receive data. 



Definition at line 606 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_aeeb4e0453d1d48ce53d354b836fa0706}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-recv\-\_\-from@{tb\-\_\-recv\-\_\-from}}
\index{tb\-\_\-recv\-\_\-from@{tb\-\_\-recv\-\_\-from}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-recv\-\_\-from}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-recv\-\_\-from (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{{\bf tb\-\_\-session\-\_\-t} $\ast$}]{session}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_aeeb4e0453d1d48ce53d354b836fa0706}


recv from -\/ used by U\-D\-P. 



Definition at line 643 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_aedd19f27c5b2e1d8717024afed30ec51}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-resolve\-\_\-address@{tb\-\_\-resolve\-\_\-address}}
\index{tb\-\_\-resolve\-\_\-address@{tb\-\_\-resolve\-\_\-address}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-resolve\-\_\-address}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-resolve\-\_\-address (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_aedd19f27c5b2e1d8717024afed30ec51}


Resolve the address for the given listener. 


\begin{DoxyParams}{Parameters}
{\em listener} & The listener to resolve the address for. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if there was no error, -\/1 otherwise. 
\end{DoxyReturn}


Definition at line 497 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a259b174a6102fa292d1fd63125cb3035}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-send\-\_\-data@{tb\-\_\-send\-\_\-data}}
\index{tb\-\_\-send\-\_\-data@{tb\-\_\-send\-\_\-data}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-send\-\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-send\-\_\-data (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{char $\ast$}]{buff, }
\item[{int}]{size}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_a259b174a6102fa292d1fd63125cb3035}


Send data. 



Definition at line 582 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_ab66b3e6da7a5d6df6e36eaefda0a8463}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-send\-\_\-to@{tb\-\_\-send\-\_\-to}}
\index{tb\-\_\-send\-\_\-to@{tb\-\_\-send\-\_\-to}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-send\-\_\-to}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-send\-\_\-to (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{{\bf tb\-\_\-session\-\_\-t} $\ast$}]{session}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_ab66b3e6da7a5d6df6e36eaefda0a8463}


Definition at line 626 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a51ee3fc570bf367b96f646a4d15f313d}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-set\-\_\-epoll@{tb\-\_\-set\-\_\-epoll}}
\index{tb\-\_\-set\-\_\-epoll@{tb\-\_\-set\-\_\-epoll}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-set\-\_\-epoll}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-set\-\_\-epoll (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}}\label{tb__listener_8c_a51ee3fc570bf367b96f646a4d15f313d}


Set epoll for this listener. 



Definition at line 659 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_ae063a1fdce497a4e08aea504a6ab927b}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-set\-\_\-l\-\_\-stats@{tb\-\_\-set\-\_\-l\-\_\-stats}}
\index{tb\-\_\-set\-\_\-l\-\_\-stats@{tb\-\_\-set\-\_\-l\-\_\-stats}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-set\-\_\-l\-\_\-stats}]{\setlength{\rightskip}{0pt plus 5cm}void tb\-\_\-set\-\_\-l\-\_\-stats (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_ae063a1fdce497a4e08aea504a6ab927b}


Gets the stats for the listener. 

This method collects the stats for single connection servers. The stats are saved in the listener-\/$>$stats field.


\begin{DoxyParams}{Parameters}
{\em listener} & The listener to collect stats for. \\
\hline
\end{DoxyParams}


Definition at line 383 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a144e59e2470a90fc2b6e1f840da77ae8}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-set\-\_\-m\-\_\-stats@{tb\-\_\-set\-\_\-m\-\_\-stats}}
\index{tb\-\_\-set\-\_\-m\-\_\-stats@{tb\-\_\-set\-\_\-m\-\_\-stats}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-set\-\_\-m\-\_\-stats}]{\setlength{\rightskip}{0pt plus 5cm}void tb\-\_\-set\-\_\-m\-\_\-stats (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_a144e59e2470a90fc2b6e1f840da77ae8}


Gets the stats for the listener. 

This method collects the stats for multiple connection servers. The stats are saved in each of the sessions stats structs, and the total number of bytes sent are saved in the listener-\/$>$stats struct.

\begin{DoxyPrecond}{Precondition}
The listener must be of the multiple connection type. 
\end{DoxyPrecond}

\begin{DoxyParams}{Parameters}
{\em listener} & The listener to collect stats for. \\
\hline
\end{DoxyParams}


Definition at line 416 of file tb\-\_\-listener.\-c.

\hypertarget{tb__listener_8c_a104d49d9fbeed470cf0a9de8706c0af8}{\index{tb\-\_\-listener.\-c@{tb\-\_\-listener.\-c}!tb\-\_\-setup\-\_\-workers@{tb\-\_\-setup\-\_\-workers}}
\index{tb\-\_\-setup\-\_\-workers@{tb\-\_\-setup\-\_\-workers}!tb_listener.c@{tb\-\_\-listener.\-c}}
\subsubsection[{tb\-\_\-setup\-\_\-workers}]{\setlength{\rightskip}{0pt plus 5cm}int tb\-\_\-setup\-\_\-workers (
\begin{DoxyParamCaption}
\item[{{\bf tb\-\_\-listener\-\_\-t} $\ast$}]{listener, }
\item[{int}]{num\-\_\-threads}
\end{DoxyParamCaption}
)}}\label{tb__listener_8c_a104d49d9fbeed470cf0a9de8706c0af8}


Definition at line 232 of file tb\-\_\-listener.\-c.

